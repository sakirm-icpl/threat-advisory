{"ast":null,"code":"import{useState,useEffect,createContext,useContext}from'react';import{api}from'../services/api';import toast from'react-hot-toast';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export function AuthProvider(_ref){let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);useEffect(()=>{const token=localStorage.getItem('access_token');if(token){api.defaults.headers.common['Authorization']=`Bearer ${token}`;fetchUser();}else{setLoading(false);}},[]);const fetchUser=async()=>{try{const response=await api.get('/auth/me');setUser(response.data);}catch(error){localStorage.removeItem('access_token');localStorage.removeItem('refresh_token');delete api.defaults.headers.common['Authorization'];}finally{setLoading(false);}};const login=async(username,password)=>{try{const response=await api.post('/auth/login',{username,password});const{access_token,refresh_token,user:userData}=response.data;localStorage.setItem('access_token',access_token);localStorage.setItem('refresh_token',refresh_token);api.defaults.headers.common['Authorization']=`Bearer ${access_token}`;setUser(userData);toast.success('Login successful!');return true;}catch(error){var _error$response,_error$response$data;toast.error(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.error)||'Login failed');return false;}};const logout=()=>{localStorage.removeItem('access_token');localStorage.removeItem('refresh_token');delete api.defaults.headers.common['Authorization'];setUser(null);toast.success('Logged out successfully');};const refreshToken=async()=>{try{const refresh_token=localStorage.getItem('refresh_token');if(!refresh_token)throw new Error('No refresh token');const response=await api.post('/auth/refresh',{},{headers:{Authorization:`Bearer ${refresh_token}`}});const{access_token}=response.data;localStorage.setItem('access_token',access_token);api.defaults.headers.common['Authorization']=`Bearer ${access_token}`;return true;}catch(error){logout();return false;}};const value={user,loading,login,logout,refreshToken};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});}export function useAuth(){const context=useContext(AuthContext);if(!context){throw new Error('useAuth must be used within an AuthProvider');}return context;}","map":{"version":3,"names":["useState","useEffect","createContext","useContext","api","toast","jsx","_jsx","AuthContext","AuthProvider","_ref","children","user","setUser","loading","setLoading","token","localStorage","getItem","defaults","headers","common","fetchUser","response","get","data","error","removeItem","login","username","password","post","access_token","refresh_token","userData","setItem","success","_error$response","_error$response$data","logout","refreshToken","Error","Authorization","value","Provider","useAuth","context"],"sources":["C:/Users/sakirm/Downloads/versionintel/frontend/src/hooks/useAuth.js"],"sourcesContent":["import { useState, useEffect, createContext, useContext } from 'react';\r\nimport { api } from '../services/api';\r\nimport toast from 'react-hot-toast';\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport function AuthProvider({ children }) {\r\n  const [user, setUser] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const token = localStorage.getItem('access_token');\r\n    if (token) {\r\n      api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n      fetchUser();\r\n    } else {\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  const fetchUser = async () => {\r\n    try {\r\n      const response = await api.get('/auth/me');\r\n      setUser(response.data);\r\n    } catch (error) {\r\n      localStorage.removeItem('access_token');\r\n      localStorage.removeItem('refresh_token');\r\n      delete api.defaults.headers.common['Authorization'];\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const login = async (username, password) => {\r\n    try {\r\n      const response = await api.post('/auth/login', { username, password });\r\n      const { access_token, refresh_token, user: userData } = response.data;\r\n      \r\n      localStorage.setItem('access_token', access_token);\r\n      localStorage.setItem('refresh_token', refresh_token);\r\n      api.defaults.headers.common['Authorization'] = `Bearer ${access_token}`;\r\n      \r\n      setUser(userData);\r\n      toast.success('Login successful!');\r\n      return true;\r\n    } catch (error) {\r\n      toast.error(error.response?.data?.error || 'Login failed');\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const logout = () => {\r\n    localStorage.removeItem('access_token');\r\n    localStorage.removeItem('refresh_token');\r\n    delete api.defaults.headers.common['Authorization'];\r\n    setUser(null);\r\n    toast.success('Logged out successfully');\r\n  };\r\n\r\n  const refreshToken = async () => {\r\n    try {\r\n      const refresh_token = localStorage.getItem('refresh_token');\r\n      if (!refresh_token) throw new Error('No refresh token');\r\n      \r\n      const response = await api.post('/auth/refresh', {}, {\r\n        headers: { Authorization: `Bearer ${refresh_token}` }\r\n      });\r\n      \r\n      const { access_token } = response.data;\r\n      localStorage.setItem('access_token', access_token);\r\n      api.defaults.headers.common['Authorization'] = `Bearer ${access_token}`;\r\n      \r\n      return true;\r\n    } catch (error) {\r\n      logout();\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const value = {\r\n    user,\r\n    loading,\r\n    login,\r\n    logout,\r\n    refreshToken\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={value}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useAuth() {\r\n  const context = useContext(AuthContext);\r\n  if (!context) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n  return context;\r\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}